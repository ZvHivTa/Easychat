------

# Easychat Project





## 1. 简介（Project Overview）

**Easychat** 是一个基于 **Java** 语言开发的开源即时通讯（IM）客户端，专为连接 **Openfire XMPP 服务器**而设计。

- **核心目标:** 成为企业或小团队内部私有化部署 Openfire 服务器的配套客户端。
- **技术栈:** **Java** (主要语言),**JavaFX** (主要框架), **Maven** (依赖管理/构建)。
- **协议:** **XMPP** (Extensible Messaging and Presence Protocol)。



## 2. 技术选型 (Current Tech Stack & Strategy)



| 方面           | 现状                       | 选型策略/未来方向                                     |
| -------------- | -------------------------- | ----------------------------------------------------- |
| **编程语言**   | 98.9% **Java**             | 保持 Java 核心，确保稳定性和跨平台潜力。              |
| **构建工具**   | **Maven** (`pom.xml` 存在) | 沿用 Maven，标准化构建和依赖管理。                    |
| **UI/UX 框架** | JavaFX                     |                                                       |
| **XMPP 库**    | Smack 库                   |                                                       |
| **数据存储**   | Mysql                      | 改用更安全的数据库类型，增加缓存功能等。              |
| **加密协议**   | 自带的TLS/SSL协议          | 密码使用JWT令牌，密码自身采用MD5或者RSA加密保证安全。 |



## 3. 核心功能路线图 (Core Feature Roadmap)



我们的开发将分为三个主要版本迭代：



###  V1.0 - 基础客户端 (Minimum Viable Product)



**目标：** 实现稳定连接和核心单聊功能。

- **服务器配置:** 允许用户配置并保存 **Openfire 服务器 IP/端口**。
- **用户认证:** 实现 Openfire 账号的登录和登出。
- **基础聊天:**
  - 发送和接收一对一**文本消息**。
  - 实时显示好友的**在线状态**（Presence）。
- **代码清理:** 对现有 Java 代码进行模块化重构，确保 Maven 构建流程顺畅。



### V1.1 - 增强通讯 (Enhanced Communication)



**目标：** 引入联系人管理和群组聊天功能。

- **联系人管理:**
  - 添加、删除、分组联系人（Roster Management）。
  - **本地存储**联系人列表和用户配置（使用 SQLite）。
- **群组聊天 (MUC):**
  - 支持加入和退出 Openfire 上的**聊天室/群组**。
  - 群组消息的发送和接收。
- **通知系统:** 桌面通知和新消息声音提醒。
- **界面优化:** 基于 JavaFX 实现一个更直观的联系人列表和聊天窗口 UI。



### V1.2+ - 高级特性与优化 (Advanced Features & Polishing)



**目标：** 提高用户体验和实用性，加入高级功能。

- **文件传输:** 实现 XMPP 协议下的**点对点（P2P）**或**代理（Proxy）**文件传输。
- **消息历史:** 完整的本地消息历史记录查看和搜索功能。
- **多媒体支持:** 自动解析和显示图片，支持表情符号。
- **安全性:** 使用JWT令牌，确保客户端和服务端通信安全。

## 4. XMPP协议(XMPP protocol)

### 1）概述

XMPP（Extensible Messaging and Presence Protocol）是一种开放式、以XML为基础的即时通讯协议。XMPP由1998年创建的Jabber协议扩展而成，后由IETF（Internet Engineering Task Force）标准化组织进行标准化，被广泛应用于即时通讯系统、社交网络、物联网等领域。

由于其高性能、低开销的特性，有许多即时通讯软件和需要即时通讯功能的软件采用该协议，例如：WhatsApp、任天堂Switch、Google等。

### 2）通信原理

XMPP协议是基于客户端-服务器模式的，但它是分散式的，并没有所谓的“中央服务器”。任何人都可以把服务器部署在自己的实体或云服务器上，在自己的局域网上或公网上运行。

在XMPP协议中，用户需要先进行注册，获取一个JID（Jabber Identifier）标识，然后才能登录到服务器。JID由用户名（Local part）、域名(Domain part)和可选的资源名(Resource part)组成，用户名部分与其他部分用类似电子邮件的格式“@”隔开，如图所示。

![image-20250928145414464](C:\Users\ZvHiv\AppData\Roaming\Typora\typora-user-images\image-20250928145414464.png)

域名是一个XMPP服务器的唯一标识，它可以是服务器的IP地址或是一个特定名称，是一个JID不可或缺的；用户名是一个用户在该XMPP服务器下的唯一标识，是不允许重复的，简单来说，就是一个XMPP服务器的账号数据库中只能有一个Juliet；资源名在JID中的作用是为用户提供用于区分同一用户在不同设备上的登录状态的标识，例如，一个用户可能在手机和电脑上同时登录XMPP客户端，此时可以通过资源名来区分用户在哪个设备上在线，从而实现消息推送、文件发送（必须指定发送的具体资源名以决定发送到哪个端）、状态同步等功能。以上就是JID各部分的基本意义。

现在假设Juliet想和Romeo以XMPP协议通话，他们的账号分别在域名为Capulet.com及Montague.net的服务器上。当Juliet输入消息并按下发送钮之后，以下是网络中发生的事件（如图2-2所示）：

1. uliet的XMPP客户端将她的消息传送到Capulet.com XMPP服务器；
2. Capulet.com XMPP服务器开启与Montague.net XMPP服务器的连接；
3. Montague.net XMPP服务器将消息传送给Romeo。如果他目前不在线上，那么储存消息以待稍后传送；

![image-20250928145514320](C:\Users\ZvHiv\AppData\Roaming\Typora\typora-user-images\image-20250928145514320.png)

这个过程中需要注意的是，两人所属的XMPP服务器是由两家不同的互联网公司提供的。他们彼此通讯时，可以不必互相持有对方服务器的账号，甚至可以不属于同一个应用。

以上是XMPP服务器单聊的原理，与之相比，**群聊**的原理更为复杂。

Openfire 群聊的原理是基于 XMPP 协议的 Multi-User Chat (MUC) 扩展实现的。MUC 扩展是一种协议，它允许多个用户在同一房间中进行群聊。一台Openfire服务器可以有多个MUC服务。一个MUC服务具有唯一的JID标识，由服务名或叫做子域名（Subdomain）和服务器域名（Domain Part）组成。而一个MUC服务中可以有多个聊天房间。

例如，Juliet所用的XMPP服务器中有一个创建好的MUC服务名为“conference”，那么该MUC服务的JID应该为“conference.Capulet.com”。

这时Juliet想在该服务下创建一个名为“JulietMUC”的群聊，当她创建成功后，这个房间的唯一JID也就被分配好了，如图所示。

![image-20250928145625504](C:\Users\ZvHiv\AppData\Roaming\Typora\typora-user-images\image-20250928145625504.png)

Juliet在群聊发送第一条消息“Hello！”，等同于向群聊内的所有成员（包括她自己）发送广播，因此她本人也会得到一份由群聊服务器发送的、消息体完全相同的消息。离线消息的处理方式和单聊类似，先由服务器暂存，等待上线后一并按顺序发送。

### 3）报文类型

在XMPP协议中，有三种基本的报文类型：IQ、Presence和Message。每种报文类型的作用如下：

①IQ（Information Query）：用于信息查询。IQ报文可以包含请求、响应和错误三种类型，通常用于客户端与服务器之间的交互。例如，用于获取好友列表、获取群组信息等。

②Presence：用于表示用户的在线状态。Presence报文可以指示用户的可用性、资源信息和状态等，可以广播到用户的好友和群组中，用于实现实时通知和状态同步等功能。

③Message：用于传输文本消息。Message报文可以包含多种类型的消息，例如普通文本、HTML、富媒体等，用于实现即时通讯功能。

除了这三种基本的报文类型之外，XMPP协议还支持通过扩展机制（Extension part），添加其他类型的报文。例如，文件传输、语音、视频等功能，都可以通过扩展协议实现。

### 4）优点和缺点

XMPP协议具有以下优点：

- 开放式协议：XMPP协议是一种开放式协议，任何人都可以自由地使用和实现该协议，没有版权和专利问题。
- 可扩展性：XMPP协议是基于XML的，允许通过扩展XML格式来定义新的协议扩展和应用程序，易于应用在例如文件传输、语音视频通话、即时游戏等。
- 安全性：XMPP协议支持TLS/SSL协议进行数据传输的加密和身份验证，保证通信安全性，同时，XMPP协议还支持SASL身份验证、数字签名等安全机制。
- 实时性：XMPP协议是一种实时协议，能够快速传输数据和状态信息，满足即时通讯的需求。
- 分布式架构：XMPP协议采用分布式架构，使得系统具有更高的可扩展性和可靠性，可以支持大规模的用户群体。
- 多平台支持：XMPP协议可以在多种操作系统、编程语言和开发框架上进行实现和部署。

XMPP协议同时又具有以下缺点：

- 负载重：由于XMPP协议是基于XML的，其格式带来了严重的重复转发问题，通常超过70％的XMPP服务器的资料流量存在重复转发问题。
- 二进制文件传输受限： XMPP传输单一的XML报文，因此要通过XMPP传输二进制文件，需先将二进制文件以Base64编码。但是对于大量的二进制文件传输，较佳的作法是用外部的其他协定传输，而以XMPP进行沟通。至于其他二进制资料加密会话（encrypted conversations）或图形图标（graphic icons）以嵌入式使用相同的方法。

因此这个协议经常用在一些“嵌入”的场景中，比如团队游戏内部的聊天室，因为需要携带多样的身份信息，例如游戏id、角色id、团队id等等大量复杂的身份信息，并且这种聊天是即时性且临时的，游戏结束就会释放。

### 5）开源服务器Openfire

Openfire是一个开源的由Java编写的即时通讯服务器，基于XMPP协议，由Ignite Realtime开发和维护。 Openfire支持跨平台运行，包括Windows、Linux和Mac等操作系统。Openfire拥有一个较大的开发者社区，提供丰富的文档、教程和支持，开发者可以方便地获取帮助和交流经验。另外它还受到**Smack**的支持。

**Smack**是一个开源的XMPP客户端编程库，使用Java语言编写，由Ignite Realtime维护。它可以用于开发基于XMPP协议的即时通讯客户端，支持一对一和多人聊天、在线状态、文件传输、语音和视频聊天等功能。

Smack提供了一系列Java类和方法，可以简化XMPP客户端开发的过程。它以XMPP连接为核心，通过连接对象，能够通过工厂模式创建几乎所有的业务管理对象。开发者只需以连接对象为基础，在此之上利用业务对应的Manager类，通过挂载监听器的方式等，即可进行对应业务的管理。

